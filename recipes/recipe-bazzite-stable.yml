---
# yaml-language-server: $schema=https://schema.blue-build.org/recipe-v1.json
name: bazzite-stable-customized
description: My personal flavor of Bazzite
base-image: ghcr.io/ublue-os/bazzite
image-version: stable-43

modules:
  - type: script
    snippets:
      - "echo fs.inotify.max_user_instances=524288 | tee -a /etc/sysctl.conf" # https://github.com/rmcrackan/Libation/commit/824f65baae146347bf8019c5ccaac2ac7e6b2788#diff-baa268e4cdad1654bdc387ef62a711fe49e9fe6fce67e79d34780938ecd43997R107

  - type: dnf
    install:
      packages:
        - cdrskin
        - clatd
        - ddrescue
        - git-credential-libsecret
        - htop
        - k3b
        - https://github.com/rmcrackan/Libation/releases/download/v12.7.3/Libation.12.7.3-linux-chardonnay-amd64.rpm
        - lziprecover
        - micro
        - openrgb
        - rmlint
    remove:
      packages:
        - rocm-clinfo
        - rocm-hip
        - rocm-opencl
        - rocm-smi
        - tailscale

  - type: chezmoi
    repository: https://github.com/OmegaSquad82/dotfiles

  - type: files
    files:
      - source: system
        destination: /

  - type: default-flatpaks
    configurations:
      - scope: system
        repo:
          title: Flathub (system)
        install:
          # unverified
          - com.calibre_ebook.calibre
          - com.nextcloud.desktopclient.nextcloud
          - com.synology.SynologyDrive
          - io.github.pwr_solaar.solaar
          - org.jitsi.jitsi-meet
          - org.signal.Signal
          - org.videolan.VLC
          # verified
          - com.daniel15.wcc
          - com.discordapp.Discord
          - com.github.Matoking.protontricks
          - com.github.tchx84.Flatseal
          - com.logseq.Logseq
          - com.ranfdev.DistroShelf
          - com.usebottles.bottles
          - com.vysp3r.ProtonPlus
          - org.fedoraproject.MediaWriter
          - info.beyondallreason.bar
          - io.github.flattool.Warehouse
          - io.github.nroduit.Weasis
          - io.gitlab.librewolf-community
          - io.github.pieterdd.StretchBreak
          - io.github.pol_rivero.github-desktop-plus
          - io.github.ungoogled_software.ungoogled_chromium
          - io.podman_desktop.PodmanDesktop
          - md.obsidian.Obsidian
          - net.ptilouk.superfluous
          - org.mozilla.Thunderbird
          - org.kde.gwenview
          - org.kde.haruna
          - org.kde.kcalc
          - org.kde.okular
          - org.keepassxc.KeePassXC
          - org.libreoffice.LibreOffice
          - org.torproject.torbrowser-launcher

  - type: systemd
    system:
      enabled:
        - clatd.service
        - podman.service
        - sshd.service
        - zram-compaction.timer
        - zram-recompression.timer

  - type: kargs
    arch: x86_64
    kargs:
      - rootflags=subvol=root,compress-force=zstd:3,discard=async,lazytime,noatime,space_cache=v2,x-systemd.device-timeout=0 kvm.ignore_msrs=1 kvm.report_ignored_msrs=0

  - type: signing
